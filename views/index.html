<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>BEAM - a personal finance visualizer</title>

        <link rel="stylesheet" type="text/css" href="./static/style.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    </head>
    <body class="container" id="container">
        <div class="initial-view px-4 py-5 my-5 text-center">
            <h1 class="display-1 fw-bold">BEAM</h1>
            <div class="col-lg-6 mx-auto">
                <p class="lead mb-4">
                    Gain insight to your personal finances with BEAM, an application that obtains your data through <a href="https://plaid.com/how-it-works-for-consumers/" target="_blank">Plaid</a> and provides enlightening visualizations which help you to understand the flow of your money.
                </p>
                <div id="initial-spinner" class=" spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <button type="button" id="link-button" class="btn btn-lg btn-primary">
                    Connect with Plaid
                </button>
            </div>
        </div>
        <div class="connected-view">

        </div>

        <script src="./static/jQuery.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
        <script>
            function render_page($, page_info) {
                var products = page_info.products;
                var handler = null;
                $.post("/api/create_link_token", {}, function (data) {
                    console.log("Response for request to /api/create_link_token");
                    console.log(data);

                    if (data.error != null) {
                        $('.initial-spinner').hide();
                        displayError($("#container"), data.error);
                        return;
                    }

                    $("#initial-spinner").hide();
                    $("#link-button").show();
                })

            }

            $.post("/api/info", {}, function(result){
                console.log("Response for request to /api/info");
                console.log(result);
                render_page(jQuery, result);
            });

            function displayError(element, error) {
                var html = `
                    <div class="alert alert-danger">
                        <p><strong>Error Code:</strong> ${error.error_code}</p>
                        <p><strong>Error Type:</strong> ${error.error_type}</p>
                        <p><strong>Error Message:</strong> ${
                            error.display_message == null
                            ? error.error_message
                            : error.display_message
                        }</p>
                    </div>
                `;
                $(element).html(html).slideDown();
            }
        </script>
    </body>
</html>
